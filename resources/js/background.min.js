(function(e,t,o,r,n){"use strict";function l(e,t){return new x(e,t)}var s="datacontextConfig";t.module("powellDevTools").factory(s,["$q","datacontextUtility",l]);var i=function(e){var t=e.url,o=e.url,r=/(cdn.powell-365.com|powell365-cdn.azureedge.net)\/scripts\/(?:powell(?:\/debug)?\?siteCollectionUrl=|Premium)/i,n=/powell365-cdn.azureedge.net/i,l=/#powellDevTools=1/,s=!l.exec(t)&&r.exec(t);if(s){var i=null!=n.exec(t);o=x.utility.get_jsSourceUrl(i)+"#powellDevTools=1"}return{redirectUrl:o}},c=function(e){var t,o=e.url,r=e.url,n=/powell365-cdn.azureedge.net/i,l=/[^\/\\&\?]+\.\w{3,4}(?=([\?&].*$|$))/;if(t=x.utility.get_defautCssOnCdnState()?/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/styles\//i:x.utility.get_defaultCssURL()){if(t.exec&&null!==t.exec(o)||o.indexOf(t)>=0){var s=null!=n.exec(o),i=o.match(l)[0];r=x.utility.get_cssSourceUrl(i,s)}return{redirectUrl:r}}},a=[],u=function(e){a[e.tabId]=!a[e.tabId];var t=e.url,o=e.url,r=/powell365-cdn.azureedge.net/i;null!=r.exec(t);if(o=x.utility.get_headerFooterHtmlTemplateUrl(t,a[e.tabId]),o!=t)return{redirectUrl:o}},d=function(e){var t=e.url,o=e.url,r=/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/+(?:(?:\w|\S)+\/+)+(\S+\.html)/i,n=r.exec(t);if(n){var l=x.utility.get_htmlTemplate(n[1]);l.isOverriden&&(o=x.utility.get_htmlSourceUrl(l.fileName))}return{redirectUrl:o}},m=function(e){var t=e.url,o=e.url,r=/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/styles.*\/logo-my-portal\.png/i,n=/powell365-cdn.azureedge.net/i,l="logo-my-portal.png";if(null!==r.exec(t)){var s=null!=n.exec(t);o=x.utility.get_logoSourceUrl(l,s)}return{redirectUrl:o}},p=function(e){for(var t=!1,o=e.requestHeaders,r={},n=0,l=o.length;n<l;++n)if("Referer"==o[n].name){o[n].value=x.utility.get_xhrOrigin(),t=!0;break}return t||o.push({name:"Referer",value:x.utility.get_xhrOrigin()}),r.requestHeaders=o,r},g=function(e,t){for(var o=[],r=0;r<e.length;r++)for(var n=0;n<t.length;n++)o.push(e[r]+t[n]);return o},w=function(e,t,r){if(e){var n=["*://r7-cdn.powell-365.com/","*://cdn.powell-365.com/","*://r7-powell365-cdn.azureedge.net/","*://powell365-cdn.azureedge.net/"],l=["styles/Premium/*/*/*/images/logo-my-portal.png"],s=["styles/Premium/*/*/*/powell.css"],a=["scripts/Premium/*/*/*/powell"],w=["Common/*/*/*//HtmlTemplates/*"],f=["Common/*/*/*//layouts/*.html","Common/*/*/*//Templates/*/*.html","Common//Templates/*/*.html"],h="*://*/*",b={},y=["blocking"];switch(t){case"js":b.types=["script"],b.urls=g(n,a),o.webRequest.onBeforeRequest.addListener(i,b,y);break;case"css":b.types=["image"],b.urls=g(n,l),o.webRequest.onBeforeRequest.addListener(m,b,y),b.types=["stylesheet"],b.urls=g(n,s),b.urls.push(h),o.webRequest.onBeforeRequest.addListener(c,b,y),b.urls=g(n,w),b.types=["xmlhttprequest"],o.webRequest.onBeforeRequest.addListener(u,b,y);break;case"html":b.urls=g(n,f),b.types=["xmlhttprequest"],o.webRequest.onBeforeRequest.addListener(d,b,y);case"xhr":b.urls=g(n,["*"]),b.types=["xmlhttprequest"],y.push("requestHeaders"),o.webRequest.onBeforeSendHeaders.addListener(p,b,y)}}else switch(t){case"js":o.webRequest.onBeforeRequest.removeListener(i);break;case"css":o.webRequest.onBeforeRequest.removeListener(c),o.webRequest.onBeforeRequest.removeListener(m);break;case"xhr":o.webRequest.onBeforeSendHeaders.removeListener(p)}x.utility.set_isEnabled(t,e),v()},f=function(e,t){o.webRequest.onBeforeRequest.hasListener(u)},h=function(t){t!=e.GLOBAL&&o.runtime.reload()},v=function(){var e=x.utility.enabledFourState(),t=(x.icons[e]||x.icons.all).color,r=x.icons[e]&&x.icons[e].text||e,n=(x.icons[e]||x.icons.all).icon;o.browserAction.setBadgeBackgroundColor({color:t}),o.browserAction.setBadgeText({text:r}),o.browserAction.setIcon({path:n})},b=function(e,t,o){return"powDevTools.setEnabled"==e.action&&w(e.enabled,e.sourceKind),"powDevTools.checkScriptFreshness"==e.action&&h(e.globalMD5),"powDevTools.valueUpdated"==e.action&&f(e.data.name,e.data.value),!0},x=function(e,t){x.$q=e,x.utility=t,x.icons={js:{color:"#EFBE19",text:"js",icon:"resources/img/icon19.png"},css:{color:"#2FA9DA",text:"css",icon:"resources/img/icon19.png"},html:{color:"#cd62f3",text:"html",icon:"resources/img/icon19.png"},xhr:{color:"#2af32d",text:"xhr",icon:"resources/img/icon19.png"},all:{color:"#F3672A",text:"all",icon:"resources/img/icon19.png"},none:{color:"#000",text:"none",icon:"resources/img/icon19_disabled.png"}}},y=function(){r.PowellDevTools_js_enabled=!1,r.PowellDevTools_css_enabled=!1,r.PowellDevTools_xhr_enabled=!1,r.PowellDevTools_html_enabled=!1,o.browserAction.setBadgeText({text:""}),o.runtime.onMessage.addListener(b),v()};t.module("powellDevTools").run(["datacontextConfig",y]),o.notifications.create(null,{type:"basic",iconUrl:"resources/img/icon128.png",title:"Powell Dev Tools",message:"Plugin reloaded."});var q={conditions:[new o.declarativeContent.PageStateMatcher({pageUrl:{urlMatches:".sharepoint.com",schemes:["https"]}})],actions:[new o.declarativeContent.RequestContentScript({js:["/resources/js/contentscript.js"]})]};o.runtime.onInstalled.addListener(function(e){o.declarativeContent.onPageChanged.removeRules(n,function(){o.declarativeContent.onPageChanged.addRules([q])})})})(window,window.angular,window.chrome,window.localStorage);