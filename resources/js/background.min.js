(function(e,t,o,r,l){"use strict";function n(e,t){return new x(e,t)}var s="datacontextConfig";t.module("powellDevTools").factory(s,["$q","datacontextUtility",n]);var i=function(e){var t=e.url,o=e.url,r=/(cdn.powell-365.com|powell365-cdn.azureedge.net)\/scripts\/(?:powell(?:\/debug)?\?siteCollectionUrl=|Premium)/i,l=/powell365-cdn.azureedge.net/i,n=/#powellDevTools=1/,s=!n.exec(t)&&r.exec(t);if(s){var i=null!=l.exec(t);o=x.utility.get_jsSourceUrl(i)+"#powellDevTools=1"}return{redirectUrl:o}},c=function(e){var t,o=e.url,r=e.url,l=/powell365-cdn.azureedge.net/i,n=/[^\/\\&\?]+\.\w{3,4}(?=([\?&].*$|$))/;if(t=x.utility.get_defautCssOnCdnState()?/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/styles\//i:x.utility.get_defaultCssURL()){if(t.exec&&null!==t.exec(o)||o.indexOf(t)>=0){var s=null!=l.exec(o),i=o.match(n)[0];r=x.utility.get_cssSourceUrl(i,s)}return{redirectUrl:r}}},u=[],a=function(e){u[e.tabId]=!u[e.tabId];var t=e.url,o=e.url,r=/powell365-cdn.azureedge.net/i;null!=r.exec(t);if(o=x.utility.get_headerFooterHtmlTemplateUrl(t,u[e.tabId]),o!=t)return{redirectUrl:o}},d=function(e){var t=e.url,o=e.url,r=/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/+(?:(?:\w|\S)+\/+)+(\S+\.html)/i,l=r.exec(t);if(l){var n=x.utility.get_htmlTemplate(l[1]);n.isOverriden&&(o=x.utility.get_htmlSourceUrl(n.fileName))}return{redirectUrl:o}},m=function(e){var t=e.url,o=e.url,r=/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/styles.*\/logo-my-portal\.png/i,l=/powell365-cdn.azureedge.net/i,n="logo-my-portal.png";if(null!==r.exec(t)){var s=null!=l.exec(t);o=x.utility.get_logoSourceUrl(n,s)}return{redirectUrl:o}},p=function(e){for(var t=!1,o=e.requestHeaders,r={},l=0,n=o.length;l<n;++l)if("Referer"==o[l].name){o[l].value=x.utility.get_xhrOrigin(),t=!0;break}return t||o.push({name:"Referer",value:x.utility.get_xhrOrigin()}),r.requestHeaders=o,r},g=function(e,t){for(var o=[],r=0;r<e.length;r++)for(var l=0;l<t.length;l++)o.push(e[r]+t[l]);return o},w=function(e,t,r){if(e){var l=["*://r7-cdn.powell-365.com/","*://cdn.powell-365.com/","*://r7-powell365-cdn.azureedge.net/","*://powell365-cdn.azureedge.net/"],n=["styles/Premium/*/*/*/images/logo-my-portal.png"],s=["styles/Premium/*/*/*/powell.css"],u=["scripts/Premium/*/*/*/powell"],w=["Common/*/*/*//HtmlTemplates/*"],f=["Common/*/*/*//layouts/*.html","Common/*/*/*//Templates/*/*.html","Common//Templates/*/*.html"],h="*://*/*",b={},y=["blocking"];switch(t){case"js":b.types=["script"],b.urls=g(l,u),o.webRequest.onBeforeRequest.addListener(i,b,y);break;case"css":b.types=["image"],b.urls=g(l,n),o.webRequest.onBeforeRequest.addListener(m,b,y),b.types=["stylesheet"],b.urls=g(l,s),b.urls.push(h),o.webRequest.onBeforeRequest.addListener(c,b,y),b.urls=g(l,w),b.types=["xmlhttprequest"],o.webRequest.onBeforeRequest.addListener(a,b,y);break;case"html":b.urls=g(l,f),b.types=["xmlhttprequest"],o.webRequest.onBeforeRequest.addListener(d,b,y);case"xhr":b.urls=g(l,["*"]),b.types=["xmlhttprequest"],y.push("requestHeaders"),o.webRequest.onBeforeSendHeaders.addListener(p,b,y)}}else switch(t){case"js":o.webRequest.onBeforeRequest.removeListener(i);break;case"css":o.webRequest.onBeforeRequest.removeListener(c),o.webRequest.onBeforeRequest.removeListener(m);break;case"xhr":o.webRequest.onBeforeSendHeaders.removeListener(p)}x.utility.set_isEnabled(t,e),v()},f=function(e,t){o.webRequest.onBeforeRequest.hasListener(a)},h=function(t){t!=e.GLOBAL&&o.runtime.reload()},v=function(){var e=x.utility.enabledFourState(),t=(x.icons[e]||x.icons.all).color,r=x.icons[e]&&x.icons[e].text||e,l=(x.icons[e]||x.icons.all).icon;o.browserAction.setBadgeBackgroundColor({color:t}),o.browserAction.setBadgeText({text:r}),o.browserAction.setIcon({path:l})},b=function(e,t,o){return"powDevTools.setEnabled"==e.action&&w(e.enabled,e.sourceKind),"powDevTools.checkScriptFreshness"==e.action&&h(e.globalMD5),"powDevTools.valueUpdated"==e.action&&f(e.data.name,e.data.value),!0},x=function(e,t){x.$q=e,x.utility=t,x.icons={js:{color:"#EFBE19",text:"js",icon:"resources/img/icon19.png"},css:{color:"#2FA9DA",text:"css",icon:"resources/img/icon19.png"},html:{color:"#cd62f3",text:"html",icon:"resources/img/icon19.png"},xhr:{color:"#2af32d",text:"xhr",icon:"resources/img/icon19.png"},all:{color:"#F3672A",text:"all",icon:"resources/img/icon19.png"},none:{color:"#000",text:"none",icon:"resources/img/icon19_disabled.png"}}},y=function(){r.PowellDevTools_js_enabled=!1,r.PowellDevTools_css_enabled=!1,r.PowellDevTools_xhr_enabled=!1,r.PowellDevTools_html_enabled=!1,o.browserAction.setBadgeText({text:""}),o.runtime.onMessage.addListener(b),v()};t.module("powellDevTools").run(["datacontextConfig",y]),o.notifications.create(null,{type:"basic",iconUrl:"resources/img/icon128.png",title:"Powell Dev Tools",message:"Plugin reloaded."})})(window,window.angular,window.chrome,window.localStorage);