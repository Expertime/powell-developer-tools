(function(e,o,t,r,l){"use strict";function n(e,o){return new h(e,o)}var s="datacontextConfig";o.module("powellDevTools").factory(s,["$q","datacontextUtility",n]);var i=function(e){var o=e.url,t=e.url,r=/(cdn.powell-365.com|powell365-cdn.azureedge.net)\/scripts\/(?:powell(?:\/debug)?\?siteCollectionUrl=|Premium)/i,l=/powell365-cdn.azureedge.net/i,n=/#powellDevTools=1/,s=!n.exec(o)&&r.exec(o);if(s){var i=null!=l.exec(o);t=h.utility.get_jsSourceUrl(i)+"#powellDevTools=1",console.log("Redirecting original request ["+o+"] to ["+t+"]")}return{redirectUrl:t}},c=function(e){var o,t=e.url,r=e.url,l=/powell365-cdn.azureedge.net/i,n=/[^\/\\&\?]+\.\w{3,4}(?=([\?&].*$|$))/;if(o=h.utility.get_defautCssOnCdnState()?/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/styles\//i:h.utility.get_defaultCssURL()){if(o.exec&&null!==o.exec(t)||t.indexOf(o)>=0){var s=null!=l.exec(t),i=t.match(n)[0];r=h.utility.get_cssSourceUrl(i,s),console.log("Redirecting original request ["+t+"] to ["+r+"]")}return{redirectUrl:r}}},u=function(e){var o=e.url,t=e.url,r=/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/+(?:(?:\w|\S)+\/+)+(\S+\.html)/i,l=r.exec(o);if(l){var n=h.utility.get_htmlTemplate(l[1]);n.isOverriden&&(t=h.utility.get_htmlSourceUrl(n.fileName),console.log("Redirecting original request ["+o+"] to ["+t+"]"))}return{redirectUrl:t}},a=function(e){var o=e.url,t=e.url,r=/(?:cdn.powell-365.com|powell365-cdn.azureedge.net)\/styles.*\/logo-my-portal\.png/i,l=/powell365-cdn.azureedge.net/i,n="logo-my-portal.png";if(null!==r.exec(o)){var s=null!=l.exec(o);t=h.utility.get_logoSourceUrl(n,s),console.log("Redirecting original request ["+o+"] to ["+t+"]")}return{redirectUrl:t}},d=function(e){for(var o=!1,t=e.requestHeaders,r={},l=0,n=t.length;l<n;++l)if("Referer"==t[l].name){t[l].value=h.utility.get_xhrOrigin(),o=!0;break}return o||t.push({name:"Referer",value:h.utility.get_xhrOrigin()}),r.requestHeaders=t,r},g=function(e,o){for(var t=[],r=0;r<e.length;r++)for(var l=0;l<o.length;l++)t.push(e[r]+o[l]);return t},m=function(e,o){if(e){var r=["*://r7-cdn.powell-365.com/","*://cdn.powell-365.com/","*://r7-powell365-cdn.azureedge.net/","*://powell365-cdn.azureedge.net/"],l=["styles/Premium/*/*/*/images/logo-my-portal.png"],n=["styles/Premium/*/*/*/powell.css"],s=["scripts/Premium/*/*/*/powell"],m=["Common/*/*/*//layouts/*.html","Common/*/*/*//Templates/*/*.html","Common//Templates/*/*.html"],p="*://*/*",f={},x=["blocking"];switch(o){case"js":f.types=["script"],f.urls=g(r,s),t.webRequest.onBeforeRequest.addListener(i,f,x);break;case"css":f.types=["image"],f.urls=g(r,l),t.webRequest.onBeforeRequest.addListener(a,f,x),f.types=["stylesheet"],f.urls=g(r,n),f.urls.push(p),t.webRequest.onBeforeRequest.addListener(c,f,x);break;case"html":f.urls=g(r,m),f.types=["xmlhttprequest"],t.webRequest.onBeforeRequest.addListener(u,f,x);case"xhr":f.urls=g(r,["*"]),f.types=["xmlhttprequest"],x.push("requestHeaders"),t.webRequest.onBeforeSendHeaders.addListener(d,f,x)}}else switch(o){case"js":t.webRequest.onBeforeRequest.removeListener(i);break;case"css":t.webRequest.onBeforeRequest.removeListener(c),t.webRequest.onBeforeRequest.removeListener(a);break;case"xhr":t.webRequest.onBeforeSendHeaders.removeListener(d)}h.utility.set_isEnabled(o,e),w()},p=function(o){o!=e.GLOBAL&&t.runtime.reload()},w=function(){var e=h.utility.enabledFourState(),o=(h.icons[e]||h.icons.all).color,r=h.icons[e]&&h.icons[e].text||e,l=(h.icons[e]||h.icons.all).icon;t.browserAction.setBadgeBackgroundColor({color:o}),t.browserAction.setBadgeText({text:r}),t.browserAction.setIcon({path:l})},f=function(e,o,t){return"setEnabled"==e.action&&m(e.enabled,e.sourceKind),"checkScriptFreshness"==e.action&&p(e.globalMD5),!0},h=function(e,o){h.$q=e,h.utility=o,h.icons={js:{color:"#EFBE19",text:"js",icon:"resources/img/icon19.png"},css:{color:"#2FA9DA",text:"css",icon:"resources/img/icon19.png"},html:{color:"#cd62f3",text:"html",icon:"resources/img/icon19.png"},xhr:{color:"#2af32d",text:"xhr",icon:"resources/img/icon19.png"},all:{color:"#F3672A",text:"all",icon:"resources/img/icon19.png"},none:{color:"#000",text:"none",icon:"resources/img/icon19_disabled.png"}}},x=function(){r.PowellDevTools_js_enabled=!1,r.PowellDevTools_css_enabled=!1,r.PowellDevTools_xhr_enabled=!1,r.PowellDevTools_html_enabled=!1,t.browserAction.setBadgeText({text:""}),t.runtime.onMessage.addListener(f),w()};o.module("powellDevTools").run(["datacontextConfig",x]),t.notifications.create(null,{type:"basic",iconUrl:"resources/img/icon128.png",title:"Powell Dev Tools",message:"Plugin reloaded."})})(window,window.angular,window.chrome,window.localStorage);