!function(window,angular,$,chrome,undefined){"use strict";var CONTROLLER_ID="ConfigController";function configControllerModule($scope,$element,$q,$sce,$timeout,$interval,datacontextUtility){return chrome.runtime.sendMessage({action:"powDevTools.checkScriptFreshness",globalMD5:window.PDT_GLOBAL}),new ConfigController($scope,$element,$q,$sce,$timeout,$interval,datacontextUtility)}angular.module("powellDevTools").controller(CONTROLLER_ID,["$scope","$element","$q","$sce","$timeout","$interval","datacontextUtility",configControllerModule]);var ConfigController=function($scope,$element,$q,$sce,$timeout,$interval,datacontextUtility){var _this=this;$scope.appVers="6.4.106";var scripts=document.querySelectorAll("script"),script;let branchesPromise;scripts[scripts.length-1].src.indexOf("chrome-extension://")>=0?$scope.configTemplateUrl="/resources/html/ConfigController.html":$scope.configTemplateUrl="https://cdn.jsdelivr.net/gh/Expertime/powell-developer-tools/resources/html/ConfigController.html",$scope.config={repoJsURL:datacontextUtility.get_repoJsURL(),defaultJsRepoState:datacontextUtility.get_defaultJsRepoState(),defaultLocalJsRepoState:datacontextUtility.get_defaultLocalJsRepoState(),repoCssURL:datacontextUtility.get_repoCssURL(),defaultCssRepoState:datacontextUtility.get_defaultCssRepoState(),defautCssOnCdnState:datacontextUtility.get_defautCssOnCdnState(),defaultCssURL:datacontextUtility.get_defaultCssURL(),devCssID:datacontextUtility.get_devCssID(),defaultJsTenantState:datacontextUtility.get_defaultJsTenantState(),tenantCssID:datacontextUtility.get_tenantCssID(),defaultCssTenantState:datacontextUtility.get_defaultCssTenantState(),envID:datacontextUtility.get_envID(),themeID:datacontextUtility.get_themeID(),headerID:datacontextUtility.get_headerID(),footerID:datacontextUtility.get_footerID(),useThemeState:datacontextUtility.get_useThemeState(),useHeaderState:datacontextUtility.get_useHeaderState(),useFooterState:datacontextUtility.get_useFooterState(),repoHtmlURL:datacontextUtility.get_repoHtmlURL(),defaultHtmlRepoState:datacontextUtility.get_defaultHtmlRepoState(),htmlVersion:datacontextUtility.get_htmlVersion(),sourceMode:datacontextUtility.get_sourceMode(),branch:datacontextUtility.get_branch(),cdnJsMode:datacontextUtility.get_cdnJsMode(),cdnCssMode:datacontextUtility.get_cdnCssMode(),cdnHtmlMode:datacontextUtility.get_cdnHtmlMode(),xhrOrigin:datacontextUtility.get_xhrOrigin(),encodeBingTranslation:datacontextUtility.get_encodeBingTranslation(),cdnURL:datacontextUtility.get_cdnURL(),cdnState:datacontextUtility.get_cdnState()},$scope.enableJsEmulation=datacontextUtility.isEnabled("js"),$scope.enableCssEmulation=datacontextUtility.isEnabled("css"),$scope.enableCdnEmulation=datacontextUtility.isEnabled("cdn"),$scope.enableHtmlEmulation=datacontextUtility.isEnabled("html"),$scope.enableXhrEmulation=datacontextUtility.isEnabled("xhr"),$scope.environments=datacontextUtility.ENVIRONMENTS,$scope.sourceModes=datacontextUtility.SOURCEMODES,$scope.cdnModes=datacontextUtility.CDNMODES,$scope.branches=[],fetch("https://powtesteuwgenstg.blob.core.windows.net/cdn/branches/branches.json",{headers:{"content-type":"application/json"},method:"GET"}).then(async response=>{if(response.ok){let json=await response.json();$scope.branches=json.branches,$scope.$apply()}}),$scope.$watchCollection("config",(function(newValues){for(var value in newValues)if(datacontextUtility.setLocalStorageValue(value,newValues[value]),"headerID"==value||"footerID"==value){var action="powDevTools.valueUpdated",data={name:value,value:newValues[value]};chrome.runtime.sendMessage({action:action,data:data})}$scope.emulationSources={css:datacontextUtility.get_cssSourceUrl("*.css",!1),js:datacontextUtility.get_jsSourceUrl(),html:datacontextUtility.get_htmlSourceUrl("[layouts|templates]/*.html"),cdn:datacontextUtility.get_cdnSourceUrl("*")}})),$scope.isPaneActive=function(paneId){return datacontextUtility.get_activePane().match(new RegExp(paneId))?"active":""},$scope.setActivePane=function(paneId){datacontextUtility.set_activePane(paneId)},$scope.switchChanged=function(sourceKind){var deferred=$q.defer();chrome.runtime.sendMessage({action:"powDevTools.setEnabled",enabled:!datacontextUtility.isEnabled(sourceKind),sourceKind:sourceKind},(function(response){!response&&chrome.runtime.lastError?deferred.reject(chrome.runtime.lastError):deferred.resolve(response)})),deferred.promise.catch((function(response){}))},$scope.clearLocalStorage=function(onlyClearSearchCache){var message=onlyClearSearchCache?"powDevTools.clearSearchStorage":"powDevTools.clearStorage";chrome.tabs.query({active:!0,currentWindow:!0},(function(tabs){chrome.tabs.sendMessage(tabs[0].id,{method:message},(function(storageResponse){chrome.tabs.reload(tabs[0].id,{bypassCache:!0},(function(refreshResponse){}))}))}))},$scope.Sp={Res:{Name:"",Key:"",resourceValues:"",getResourceValuesIndicator:"",btnGetResourceValues:"Get resources",getResourceValues:function(){var interval=0,loader=$interval((function(){interval++,$scope.Sp.Res.getResourceValuesIndicator=".".repeat(interval%3+1)}),500),message="powDevTools.getResourceValues",data={name:$scope.Sp.Res.Name,key:$scope.Sp.Res.Key};chrome.tabs.query({active:!0,currentWindow:!0},(function(tabs){chrome.tabs.sendMessage(tabs[0].id,{method:message,data:data},(function(resourceValues){$interval.cancel(loader),$scope.Sp.Res.getResourceValuesIndicator="",$scope.Sp.Res.resourceValues=resourceValues}))}))}}},$scope.encodeChars=function(string){return $scope.config.encodeBingTranslation?string.replace(/[ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝàáâãäåæçèéêëìíîïðñòóôõöøùúûüýÿŐőŒœŔŕŖŗŘřŚśŜŝŞşŠšŢţŤťŦŧŨũŪūŬŭŮůŰűŲųŴŵŶŷŸŹźŻżŽž]/g,(function(m){return'"'===m||"\\"===m?" ":"\\x"+m.charCodeAt(0).toString(16).toUpperCase()})):string},$scope.Bing={bingSource:"",bingDestination:"",bingTranslatingIndicator:"",btnTranslateTitle:"Traduire",translateBing:async function(){$scope.Bing.btnTranslateTitle="Traduction";var interval=0,loader=$interval((function(){interval++,$scope.Bing.bingTranslatingIndicator=".".repeat(interval%3+1)}),500),powLang=await(await fetch("https://api.scriptrapps.io/projects/powell.developper.tools/getLangs",{headers:{authorization:"Bearer UkFBRDY0NzU5MzpzY3JpcHRyOjQwQjgwQTY5RjYxNzZEN0RDQzk2Rjc3NUZDOTA0MjJG","content-type":"application/json"},method:"GET"})).json(),bingQuery={Input:$scope.Bing.bingSourcePhrase,Languages:Object.keys(powLang)},resource;datacontextUtility.get_bingTranslationResource().post(bingQuery,(function(response){$interval.cancel(loader),$scope.Bing.bingTranslatingIndicator="",$scope.Bing.btnTranslateTitle="Traduire";var result={key:$scope.Bing.bingSourceKey},resultTranslateArray={};Object.keys(response.Data).forEach((function(key){Array.isArray(powLang[key])?powLang[key].forEach((function(lcid){result[lcid]=response.Data[key],resultTranslateArray[lcid]=response.Data[key]})):(result[powLang[key]]=response.Data[key],resultTranslateArray[powLang[key]]=response.Data[key])}));var jsonKeys=Object.keys(result);jsonKeys.unshift(jsonKeys.pop()),result=(result=JSON.stringify(result,jsonKeys,4)).replace(/\'/g,"\\'"),$scope.Bing.bingDestination=result,resultTranslateArray=(resultTranslateArray=JSON.stringify(resultTranslateArray,null,1)).replace(/\'/g,"&apos;"),$scope.Bing.bingDestinationTranslateArray="<span translate translate-array='"+resultTranslateArray+"'>"+response.Data.en+"</span>"}))}}}}(window,window.angular,window.jQuery,window.chrome);