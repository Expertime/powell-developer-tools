!function(window,angular,document,undefined){var pmJsCoreLoaded=new Promise(resolve=>{var _this=this,pmJsCoreScript=document.querySelector('script[src*="/Content/js/site.min.js"]');if(pmJsCoreScript)angular?resolve():pmJsCoreScript.addEventListener("load",function(){resolve()});else{var observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){if(mutation.addedNodes)for(var i=0;i<mutation.addedNodes.length;i++){var node=mutation.addedNodes[i];node.src&&node.src.match(/Content\/js\/site.min.js/i)&&(observer.disconnect(),_this(resolve))}})});observer.observe(document.head,{childList:!0,subtree:!0,attributes:!1,characterData:!1})}});pmJsCoreLoaded.then(()=>{var firstBy=function(){function identity(v){return v}function ignoreCase(v){return"string"==typeof v?v.toLowerCase():v}function makeCompareFunction(f,opt){if(opt="number"==typeof opt?{direction:opt}:opt||{},"function"!=typeof f){var prop=f;f=function(v1){return v1[prop]?v1[prop]:""}}if(1===f.length){var uf=f,preprocess=opt.ignoreCase?ignoreCase:identity,cmp=opt.cmp||function(v1,v2){return v1<v2?-1:v1>v2?1:0};f=function(v1,v2){return cmp(preprocess(uf(v1)),preprocess(uf(v2)))}}return-1===opt.direction?function(v1,v2){return-f(v1,v2)}:f}function tb(func,opt){var x="function"==typeof this&&!this.firstBy&&this,y=makeCompareFunction(func,opt),f=x?function(a,b){return x(a,b)||y(a,b)}:y;return f.thenBy=tb,f}return tb.firstBy=tb,tb}();function resourcesManagerControllerModule($rootScope,$scope,apiService){return new ResourcesManagerController($rootScope,$scope,apiService)}var ResourcesManagerController=function($rootScope,$scope,apiService){$rootScope.$on("import-export-status-change",(event,args)=>{$rootScope.loading=args.loading});var genericConsolidate=(items,itemType,itemCallback)=>items.reduce((itemsAndAdditionalParams,item)=>{var itemToAdd={Id:item.Id,_Property:itemType.localizedParam};return itemToAdd[itemType.localizedParam]=item[itemType.localizedParam],itemType.additionalInfo&&itemType.additionalInfo.forEach(additionalInfo=>{itemToAdd[additionalInfo]=item[additionalInfo]}),itemType.additionalLocalizedParams&&itemType.additionalLocalizedParams.forEach(additionalLocalizedParam=>{itemToAdd[additionalLocalizedParam.param]=item[additionalLocalizedParam.param]}),itemCallback&&"function"==typeof itemCallback?itemCallback(itemsAndAdditionalParams,itemToAdd,item):itemsAndAdditionalParams.push(itemToAdd),itemsAndAdditionalParams},[]),genericFromSheetObject=(item,itemType,itemTypeCallback)=>{var resourcedItem={Id:item.ID};return resourcedItem[itemType.localizedParam]=Object.keys(item).filter(language=>language.match(/\(\d{1}|\d{4,5}\)$/)).map(language=>{var LCID;return{LCID:language.match(/\((\d{1}|\d{4,5})\)$/)[1],Value:item[language]}}),itemType.additionalLocalizedParams&&itemType.additionalLocalizedParams.forEach(additionalParam=>{resourcedItem[itemType.localizedParam][0]&&resourcedItem[itemType.localizedParam][0].Value&&resourcedItem[itemType.localizedParam][0].Value.indexOf(additionalParam.prefix)>-1?((resourcedItem=_.cloneDeep(resourcedItem[itemType.localizedParam]))[0].Value=resourcedItem[0].Value.split(additionalParam.prefix)[1],resourcedItem._AdditionalParamName=additionalParam.param):item[additionalParam.param]&&(resourcedItem[additionalParam.param]=Object.keys(item[additionalParam.param]).filter(language=>language.match(/\(\d{1}|\d{4,5}\)$/)).map(language=>{var LCID;return{LCID:language.match(/\((\d{1}|\d{4,5})\)$/)[1],Value:item[additionalParam.param][language]}}))}),itemTypeCallback?itemTypeCallback(resourcedItem,item,itemType):resourcedItem},genericComparator=(managerItem,sheetItem)=>managerItem.Id===sheetItem.Id,ITEM_TYPES={FIELD:{order:1,name:"Fields",sheetName:"Fields",require:["CONTENT_TYPE"],localizedParam:"DisplayName",additionalLocalizedParams:[{param:"Description",prefix:"DESCRIPTION: "}],additionalInfo:["ContentTypeName"],createParams:["Id","Name","DisplayName","Description","ShowInDisplayForm","ShowInEditForm","ShowInNewForm","ShowInDefaultView","Required","Searchable","Order","Hidden","Config","FieldId","FieldTypeId","ContentTypeId","FieldsOrderJson","ClientSideComponentId"],initFlatObject:field=>({ID:field.Id,CONTENT_TYPE:field.ContentTypeName,FIELD_PROPERTY:field._Property}),consolidate:fields=>genericConsolidate(fields,ITEM_TYPES.FIELD,(fieldsAndAdditionalParams,fieldToAdd,field)=>{var fieldAlreadyAdded=fieldsAndAdditionalParams.find(field=>field.Id===fieldToAdd.Id);fieldAlreadyAdded?fieldAlreadyAdded.ContentTypeName+=", "+field.ContentTypeName:fieldsAndAdditionalParams.push(fieldToAdd)}),fromSheetObject:field=>genericFromSheetObject(field,ITEM_TYPES.FIELD),comparator:genericComparator},CONTENT_TYPE:{order:2,name:"ContentTypes",sheetName:"Content types",require:[],waitBeforeGet:["FIELD"],localizedParam:"Name",additionalLocalizedParams:[{param:"Description",prefix:"DESCRIPTION: "}],createParams:["ContentTypeId","Description","DocumentTemplateBase64","DocumentTemplateId","DocumentTemplateInfoName","EnableNotification","Fields","FieldsOrder","HasDocumentTemplate","Id","Name","ParentContentTypeId","PublishingPage"],initFlatObject:contentType=>({ID:contentType.Id,CONTENT_TYPE_PROPERTY:contentType._Property}),consolidate:contentTypes=>genericConsolidate(contentTypes,ITEM_TYPES.CONTENT_TYPE),fromSheetObject:contentType=>genericFromSheetObject(contentType,ITEM_TYPES.CONTENT_TYPE),comparator:genericComparator},LIST_TEMPLATE:{order:3,name:"ListTemplates",sheetName:"List templates",require:[],waitBeforeGet:["CONTENT_TYPE"],localizedParam:"Title",createParams:["ContentTypes","DataModeProvisioning","DataProvisioningJson","DataProvisioningXml","DataProvisioningZipBase64","DataProvisioningZipId",'DataProvisioningZipInfoName=$ITEM_FROM_MANAGER.DataProvisioningZip.Name + "." + $ITEM_FROM_MANAGER.DataProvisioningZip.Extension',"Description","EnableFolderCreation","EnableMinorVersions","EnableModeration","EnableRating","EnableVersioning","ForceCheckout","HasDataProvisioningZip=$ITEM_FROM_MANAGER.DataProvisioningZip !== null","Hidden","Id","IsAddContent","IsIndexable","IsSearchable","IsSystemList","IsTemplate","RemoveStandardViews","SiteTemplateId","TemplateTypeId","Title","Url","ValidationFormula","ValidationUserMessage","VersioningConfigTemp=$ITEM_FROM_MANAGER.VersioningConfigObject","ViewCollection"],initFlatObject:listTemplate=>({ID:listTemplate.Id}),consolidate:listTemplates=>genericConsolidate(listTemplates,ITEM_TYPES.LIST_TEMPLATE),fromSheetObject:listTemplate=>genericFromSheetObject(listTemplate,ITEM_TYPES.LIST_TEMPLATE),comparator:genericComparator},SITE_TEMPLATE:{order:4,name:"SiteTemplates",sheetName:"Site templates",require:[],localizedParam:"Title",createParams:["AvailablePageTemplates","AvailableWidgets","Classification","DefaultPageLayoutId","DescriptionFunc","FrameworkId","GroupId","HasSaveAsTemplate","Id","IsOfficeGroup","IsPublic","NavigationIncludeTypeCurrentNavigationId","NavigationQuickLaunch","NavigationShowSiblings","NavigationSourceCurrentNavigationId","PageLayouts","PageLayoutsAll","PropertyBag","PropertyBagValue","SaveAsTemplateDescription","SaveAsTemplateName","Title","UploadedPictureBase64","UsePowellFeatures","WebPropertiesMetadata","WidgetFiles","WidgetThemeId"],initFlatObject:siteTemplate=>({ID:siteTemplate.Id}),consolidate:siteTemplates=>genericConsolidate(siteTemplates,ITEM_TYPES.SITE_TEMPLATE),fromSheetObject:siteTemplate=>genericFromSheetObject(siteTemplate,ITEM_TYPES.SITE_TEMPLATE),comparator:genericComparator},PAGE:{order:5,name:"Pages",sheetName:"Pages",require:["SITE_TEMPLATE"],skipCreateIfSelected:["WIDGET"],localizedParam:"Name",additionalInfo:["SiteTemplateName"],createParams:["BannerFileInfo","BannerId","BannerType","Description","Id","IsArticlePage","IsBannerManaged","IsPageTemplate","IsPublic","ModernAssociatedPageContentTypeId","Name","PageHeader","PageLayoutId","PreviewFileInfo","RowVersionValue","ShowPageTitle","SiteTemplateId","SubWebId","TenantAuthenticationId","TitlePosition","Url","UsePowellFeatures","WebParts","WithCommentModule"],initFlatObject:page=>({ID:page.Id,SITE_TEMPLATE:page.SiteTemplateName}),consolidate:pages=>genericConsolidate(pages,ITEM_TYPES.PAGE),fromSheetObject:page=>genericFromSheetObject(page,ITEM_TYPES.PAGE),comparator:genericComparator},PAGE_TEMPLATE:{order:6,name:"PageTemplates",sheetName:"Page templates",require:[],skipCreateIfSelected:["WIDGET"],localizedParam:"Name",createParams:["BannerFileInfo","BannerId","BannerType","Description","Id","IsArticlePage","IsBannerManaged","IsPageTemplate","IsPublic","Name","PageLayoutId","PreviewFileInfo","RowVersionValue","ShowPageTitle","SiteTemplateId","SubWebId","TenantAuthenticationId","TitlePosition","Url","UsePowellFeatures","WebParts","WithCommentModule"],initFlatObject:page=>({ID:page.Id}),consolidate:pageTemplates=>genericConsolidate(pageTemplates,ITEM_TYPES.PAGE_TEMPLATE),fromSheetObject:pageTemplate=>genericFromSheetObject(pageTemplate,ITEM_TYPES.PAGE_TEMPLATE),comparator:genericComparator},WIDGET:{order:7,name:"Widgets",sheetName:"Widgets",require:["PAGE","PAGE_TEMPLATE"],consolidateBeforeSave:{parentItemType:"PAGE",storeInto:"WebParts"},localizedParam:"Title",createParams:["Code","Config","DescriptionTech","DisplayName","Form","FrameType","Id","IsClassicWebPart","IsModernWebPart","IsPowellComponent","JsonWidgetConfig","Schema","ThemeId","Title","TitleIconUrl","WebPartCode","WebPartId","WebPartOrder","WebPartZoneCode","WebPartZoneLabel","WidgetCode","WidgetFileDisplayTemplateId","WidgetFileId","WidgetGuid","WidgetId","WidgetType","WidgetTypeCode","WidgetTypeId"],initFlatObject:widget=>({ID:widget.Id,PAGE_ID:widget.PageId,WIDGET_TYPE:"powell-365-modern-component-client-side-solution.sppkg"===widget.WidgetName?"Powell 365 Script Editor":widget.WidgetName,SITE_TEMPLATE:widget.SiteTemplateName,PAGE_TEMPLATE:widget.SiteTemplateName?null:widget.PageName,PAGE:widget.SiteTemplateName?widget.PageName:null,WIDGET_NAME:widget.LocalizedTitle,WIDGET_PROPERTY:widget._Property}),consolidate:widgets=>widgets.reduce((widgetsProperties,widget)=>(widgetsProperties.push({Id:widget.Id,PageId:widget.PageId,WidgetName:widget.Widget.Name,SiteTemplateName:widget.SiteTemplateName,PageName:widget.PageName,Title:widget.Title,LocalizedTitle:widget.LocalizedTitle.toUpperCase(),_Property:"Title"}),WIDGET_TYPES[widget.Widget.Name]&&(widgetsProperties=widgetsProperties.concat(flattenWidgetConfig(widget))),widgetsProperties),[]),fromSheetObject:(widget,languages)=>genericFromSheetObject(widget,ITEM_TYPES.WIDGET,resourcedWidget=>(resourcedWidget.PageId=widget.PAGE_ID,resourcedWidget.IsFromPageTemplate=widget.PAGE_TEMPLATE!==undefined,WIDGET_TYPES[widget.WIDGET_TYPE]&&(resourcedWidget.Config={},widget.Config&&Object.keys(widget.Config).forEach(widgetProperty=>{var widgetPropertyValue=genericFromSheetObject(widget.Config[widgetProperty],{localizedParam:widgetProperty},resourcedWidgetProperty=>resourcedWidgetProperty[widgetProperty]);widgetPropertyValue=widgetPropertyValue.map(localizedValue=>{var language=_.find(languages,language=>language.Lcid.toString()===localizedValue.LCID);return localizedValue.LCID=parseInt(localizedValue.LCID,10),localizedValue.Code=language.Code,null!==language.Code?localizedValue.Label=language.Title:localizedValue.LCID=0,localizedValue});var localizedParam=WIDGET_TYPES[widget.WIDGET_TYPE].localizedParams.find(param=>widgetProperty.match(new RegExp("^"+param.title.replace("$param","(.+)"))));if(localizedParam.param=localizedParam.param.split("|")[0],localizedParam.iterate){var index=_.get(resourcedWidget.Config,localizedParam.param.split("[]")[0],[]).length;_.set(resourcedWidget.Config,localizedParam.param.replace("[]","["+index+"]"),localizedParam.storeAsJson?JSON.stringify(widgetPropertyValue):widgetPropertyValue),localizedParam.updateAlso&&localizedParam.updateAlso.forEach(updateAlso=>{updateAlso.defaultValueOnly?_.set(resourcedWidget.Config,updateAlso.param.replace("[]","["+index+"]"),widgetPropertyValue[0].Value):_.set(resourcedWidget.Config,updateAlso.param.replace("[]","["+index+"]"),updateAlso.storeAsJson?JSON.stringify(widgetPropertyValue):widgetPropertyValue)})}else _.set(resourcedWidget.Config,localizedParam.param,localizedParam.storeAsJson?JSON.stringify(widgetPropertyValue):widgetPropertyValue),localizedParam.updateAlso&&localizedParam.updateAlso.forEach(updateAlso=>{updateAlso.defaultValueOnly?_.set(resourcedWidget.Config,updateAlso.param,widgetPropertyValue[0].Value):_.set(resourcedWidget.Config,updateAlso.param,updateAlso.storeAsJson?JSON.stringify(widgetPropertyValue):widgetPropertyValue)})})),resourcedWidget)),comparator:genericComparator},LIST:{order:8,name:"Lists",sheetName:"Lists",require:["SITE_TEMPLATE"],localizedParam:"Title",additionalLocalizedParams:[{param:"Description",prefix:"DESCRIPTION: "}],additionalInfo:["SiteTemplateName"],createParams:["Id","EnableVersioning","VersioningConfigTemp","EnableMinorVersions","EnableModeration","EnableRating","EnableFolderCreation","ForceCheckout","Hidden","IsIndexable","IsSearchable","Description","ListTemplateId","TemplateTypeId","Title","SiteTemplateId","IsSystemList","IsStandard","IsAddContent","RemoveStandardViews","ContentTypesAll"],initFlatObject:list=>({ID:list.Id,SITE_TEMPLATE:list.SiteTemplateName,LIST_PROPERTY:list._Property}),consolidate:lists=>genericConsolidate(lists,ITEM_TYPES.LIST),fromSheetObject:list=>genericFromSheetObject(list,ITEM_TYPES.LIST),comparator:genericComparator},NAVIGATION:{order:9,name:"Navigations",sheetName:"Navigations",require:[],localizedParam:"Title",additionalLocalizedParams:[{param:"SeeMoreLabel",prefix:"SEE MORE: "}],createParams:["BindingsJson","ChildrenNodes","CssClass","Description","HideTopLevelIfNoResults","Id","ImageSrc","IsAdvancedMode","IsEmptyTitle","IsHeader","IsQuery","IsStatic","KeepOriginalSize","LocalizationDescription","LocalizationSeeMore","LocalizationTitle","LocalizedTitle","OpenLinkInNewWindow","ParentNodeId","Query","RowLimit","Scope","SeeMoreLabel","ShowGroups","ShowHeaderInSimpleList","ShowHeaderWithImage","ShowInDropDown","ShowOnlyFavorites","ShowWebLogo","SortByDirection","SortByField","Template","TemplateId:","Title","URL"],initFlatObject:navigationNode=>({ID:navigationNode.Id,NAVIGATION_ID:navigationNode.NavigationId,NAVIGATION:navigationNode.NavigationName}),consolidate:navigations=>navigations.reduce((navigationNodes,navigation)=>navigationNodes.concat(flattenTree(navigation,["Nodes","ChildrenNodes"],navigationNode=>{navigationNode.NavigationId=navigation.Id,navigationNode.NavigationName=navigation.Title},!1,ITEM_TYPES.NAVIGATION)),[]),fromSheetObject:navigation=>{var indexedNodes=[];return navigation.Nodes.forEach(navigationNode=>{indexedNodes[navigationNode.ID]=genericFromSheetObject(navigationNode,ITEM_TYPES.NAVIGATION,resourcedNavigationNode=>resourcedNavigationNode._AdditionalParamName?(ITEM_TYPES.NAVIGATION.additionalLocalizedParams.forEach(additionalParam=>{resourcedNavigationNode._AdditionalParamName===additionalParam.param&&(indexedNodes[navigationNode.ID][additionalParam.param]=resourcedNavigationNode)}),indexedNodes[navigationNode.ID]):(resourcedNavigationNode.NavigationId=navigationNode.NAVIGATION_ID,resourcedNavigationNode[ITEM_TYPES.NAVIGATION.localizedParam][0]&&(resourcedNavigationNode[ITEM_TYPES.NAVIGATION.localizedParam][0].Value=resourcedNavigationNode[ITEM_TYPES.NAVIGATION.localizedParam][0].Value.replace(/((\||└| )[─ ]{3})+ /,"")),resourcedNavigationNode))}),navigation.Nodes=indexedNodes,navigation},comparator:(managerItem,sheetItem)=>managerItem.Id===sheetItem.Id&&(!sheetItem.NavigationId||managerItem.NavigationId===sheetItem.NavigationId)},SITE_COLLECTION:{order:10,name:"SiteCollections",require:[],localizedParam:null,createParams:["AllowFileSharingForGuestUsers","AlternateLanguagesAll","Description","EnableDeploymentStatus","EnvironmentDevProjectConfig","EnvironmentDevProjectConfigId",'EnvironmentId=$scope.$eval("EnvironmentId")',"EnvironmentRecetteProjectConfig","EnvironmentRecetteProjectConfigId","HasAppCatalog","HasVariations","Id","ImportTerms","IsLocalTerms","IsTemplate","LanguagesAll","LocalPathForBranding","ModelSiteCollectionId","Owner","PreviewFileInfo","PreviewId","PrincipalLanguageId","ProjectConfig","ProjectConfigId","RootSiteTemplateId","SiteScriptsToUpdate","StorageMaximumLevel","TenantAuthentificationId","TimeZoneId","Title","UrlEnvironmentDev=$ITEM_FROM_MANAGER.UrlEnvironmentDev.match(/:\\/\\/[^/]+(\\/[^/]+\\/.+)/)[1]","UrlEnvironmentRecette=$ITEM_FROM_MANAGER.UrlEnvironmentRecette.match(/:\\/\\/[^/]+(\\/[^/]+\\/.+)/)[1]","UrlEnvironmentProd=$ITEM_FROM_MANAGER.UrlEnvironmentProd.match(/:\\/\\/[^/]+(\\/[^/]+\\/.+)/)[1]","UseSiteScripts","UseSiteTemplate","UserCodeMaximumLevel","WebTemplateId","WebTemplateType","Webs"],initFlatObject:site=>({ID:site.Id,SITE_COLLECTION_ID:site.SiteCollectionId,SITE_COLLECTION:site.SiteCollectionName}),consolidate:siteCollections=>siteCollections.reduce((sites,siteWithChildren)=>sites.concat(flattenTree(siteWithChildren,"ChildrenWebs",site=>{site.SiteCollectionName=siteWithChildren.SiteCollectionName,site.SiteCollectionId=siteWithChildren.SiteCollectionId},!0,ITEM_TYPES.SITE_COLLECTION)),[]),fromSheetObject:siteCollection=>{var indexedNodes=[];return siteCollection.Webs.forEach(site=>{indexedNodes[site.ID]=genericFromSheetObject(site,ITEM_TYPES.SITE,resourcedSite=>(resourcedSite.SiteCollectionId=site.SITE_COLLECTION_ID,resourcedSite[ITEM_TYPES.SITE.localizedParam][0]&&(resourcedSite[ITEM_TYPES.SITE.localizedParam][0].Value=resourcedSite[ITEM_TYPES.SITE.localizedParam][0].Value.replace(/((\||└| )[─ ]{3})+ /,"")),resourcedSite))}),siteCollection.Webs=indexedNodes,siteCollection},comparator:genericComparator},SITE:{order:11,name:"Sites",sheetName:"Sites",require:["SITE_COLLECTION"],consolidateBeforeSave:{parentItemType:"SITE_COLLECTION",storeInto:"Webs"},localizedParam:"Title",createParams:["ChildrenWebs","Description",'EditionStatus="edit"',"HasBrokenRightsInheritance","HasCustomizedQuickLaunchNavigation","HasSiteLogo","Id","IsRoot","IsRootWeb=!$ITEM_FROM_MANAGER.ParentWebId","Level=$ITEM_FROM_MANAGER.ParentWebId && (parentWeb = $PARENT_ITEM_FROM_MANAGER.Webs.find(web => web.Id === $ITEM_FROM_MANAGER.ParentWebId)) && parentWeb.Level + 1 || 0","Lists","LocalizationTitle","LocalizedTitle","ManageSiteLogo","MasterPageBoId","MasterPageId","NavigationIncludeTypeCurrentNavigation","NavigationIncludeTypeCurrentNavigationId","NavigationIncludeTypeGlobalNavigationId","NavigationQuickLaunch","NavigationShowSiblings","NavigationSourceCurrentNavigationId","NavigationSourceGlobalNavigationId","Pages","ParentWebId","PrincipalLanguageId","PrincipalLanguageName","SearchNavigation","ServerRelativeUrl","SiteLogo","SiteLogoBase64","SiteTemplate","SiteTemplateId","TimeZoneId","Title","Url","WebPropertiesMetadata","WebTempGuid","WebTemplate","WebTemplateId","firstLoad","loaded","modified","parent"],initFlatObject:site=>({ID:site.Id,SITE_COLLECTION_ID:site.SiteCollectionId,SITE_COLLECTION:site.SiteCollectionName}),consolidate:sites=>sites.reduce((sitesFlat,siteWithChildren)=>sitesFlat.concat(flattenTree(siteWithChildren,"ChildrenWebs",site=>{site.SiteCollectionName=siteWithChildren.SiteCollectionName,site.SiteCollectionId=siteWithChildren.SiteCollectionId},!0,ITEM_TYPES.SITE)),[]),fromSheetObject:site=>genericFromSheetObject(site,ITEM_TYPES.SITE,resourcedSite=>(resourcedSite.SiteCollectionId=site.SITE_COLLECTION_ID,resourcedSite[ITEM_TYPES.SITE.localizedParam][0]&&(resourcedSite[ITEM_TYPES.SITE.localizedParam][0].Value=resourcedSite[ITEM_TYPES.SITE.localizedParam][0].Value.replace(/((\||└| )[─ ]{3})+ /,"")),resourcedSite)),comparator:(managerItem,sheetItem)=>managerItem.SiteCollectionId===sheetItem.Id},fromSheetName:sheetName=>Object.values(ITEM_TYPES).find(itemType=>itemType.sheetName===sheetName),toSheetName:itemType=>Object.keys(ITEM_TYPES).find(itemTypeKey=>ITEM_TYPES[itemTypeKey]===itemType)},WIDGET_TYPES={ContentSearch:{localizedParams:[{title:'"No results" message',param:"messageIfNoResultsList",updateAlso:[{param:"messageIfNoResults",defaultValueOnly:!0}],includeIf:'{{ifNoResults}} === "message"',storeAsJson:!0},{title:"User filter: $param",param:"refiners[].displayNames|managedPropertyDisplayName|managedProperty",iterate:!0,includeIf:"{{userCustomFilter}}",storeAsJson:!0}]},RefinementPanel:{localizedParams:[{title:"Refiner: $param",param:"refiners[].displayNames|managedPropertyDisplayName|managedProperty",iterate:!0,updateAlso:[{param:"refiners[].defaultLabel",defaultValueOnly:!0}],includeIf:"{{refiners.length}} > 0"}]},SearchBox:{localizedParams:[{title:"Search tab: $param",param:"customTabs[].Title",iterate:!0,updateAlso:[{param:"customTabs[].LocalizationTitles"}],includeIf:"{{customTabs.length}} > 0",storeAsJson:!0}]}},Endpoints={ResourceLanguages:{get:{url:"/api/language/LoadAllForResourcing",body:()=>null}},Fields:{get:{url:"/api/contenttype/LoadById",body:id=>({Id:id})},getBySheetItem:{url:"/api/field/LoadById",body:id=>({Id:id})},set:{url:"/api/field/create",body:(localization,originalField,languages)=>localizableItemSetBody(localization,originalField,languages,ITEM_TYPES.FIELD)}},ContentTypes:{get:{url:"/api/contenttype/LoadAllAvailableByTenant",body:()=>null},getBySheetItem:{url:"/api/contenttype/LoadById",body:id=>({Id:id})},set:{url:"/api/contenttype/create",body:(localization,originalContentType,languages)=>localizableItemSetBody(localization,originalContentType,languages,ITEM_TYPES.CONTENT_TYPE)}},ListTemplates:{get:{url:"/api/list/LoadListTemplatesPaged",body:pageSize=>({ResultSource:0,Page:0,PageSize:pageSize})},getBySheetItem:{url:"/api/list/LoadListTemplateById",body:id=>({Id:id})},set:{url:"/api/list/createListTemplate",body:(localization,originalListTemplate,languages)=>localizableItemSetBody(localization,originalListTemplate,languages,ITEM_TYPES.LIST_TEMPLATE)}},SiteTemplates:{get:{url:"/api/sitetemplates/LoadAll",body:()=>null},getBySheetItem:{url:"/api/sitetemplates/LoadById",body:id=>({Id:id})},set:{url:"/api/sitetemplates/create",body:(localization,originalSiteTemplate,languages)=>localizableItemSetBody(localization,originalSiteTemplate,languages,ITEM_TYPES.SITE_TEMPLATE)}},Pages:{get:{url:"/api/page/LoadBySiteId",body:id=>({Id:id})},getBySheetItem:{url:"/api/page/LoadById",body:id=>({Id:id})},set:{url:"/api/page/create",body:(localization,originalPage,languages)=>localizableItemSetBody(localization,originalPage,languages,ITEM_TYPES.PAGE)}},PageTemplates:{get:{url:"/api/page/LoadPageTemplateByTenantId",body:id=>({Id:id})},getBySheetItem:{url:"/api/page/LoadById",body:id=>({Id:id})},set:{url:"/api/page/create",body:(localization,originalPage,languages)=>localizableItemSetBody(localization,originalPage,languages,ITEM_TYPES.PAGE_TEMPLATE)}},Widgets:{get:{url:"/api/page/LoadById",body:id=>({Id:id})},getBySheetItem:{url:"/api/page/LoadById",body:id=>({Id:id})},set:{body:(localization,originalWidget,languages)=>localizableItemSetBody(localization,originalWidget,languages,ITEM_TYPES.WIDGET)}},WidgetsInPageTemplates:{get:{url:"/api/page/LoadById",body:id=>({Id:id})},getBySheetItem:{url:"/api/page/LoadById",body:id=>({Id:id})},set:{body:(localization,originalWidget,languages)=>localizableItemSetBody(localization,originalWidget,languages,ITEM_TYPES.WIDGET_IN_PAGE_TEMPLATE)}},Lists:{get:{url:"/api/list/LoadListsBySiteId",body:id=>({Id:id})},getBySheetItem:{url:"/api/list/LoadById",body:id=>({Id:id})},set:{url:"/api/list/Create",body:(localization,originalList,languages)=>localizableItemSetBody(localization,originalList,languages,ITEM_TYPES.LIST)}},Navigations:{get:{url:"/api/navigation/LoadAll",body:()=>null},set:{url:"/api/navigation/Create",body:(localization,originalNavigation,languages)=>localizableItemSetBody(localization,originalNavigation,languages,ITEM_TYPES.NAVIGATION)}},SiteCollections:{get:{url:"/api/sitecollection/LoadByTenantPaged",body:pageSize=>({ResultSource:0,Page:0,PageSize:pageSize})},getBySheetItem:{url:"/api/sitecollection/LoadById",body:id=>({Id:id})},set:{url:"/api/sitecollection/Create",body:(localization,originalSiteCollection,languages)=>localizableItemSetBody(localization,originalSiteCollection,languages,ITEM_TYPES.SITE_COLLECTION)}},Sites:{get:{url:"/api/subweb/LoadBySiteCollection",body:id=>({Id:id})},getBySheetItem:{url:"/api/subweb/LoadById",body:(id,siteCollectionId)=>({Id:id,SiteCollectionId:siteCollectionId})},set:{body:(localization,originalSite,languages)=>localizableItemSetBody(localization,originalSite,languages,ITEM_TYPES.SITE)}}},ManagerBaseUrl="https://manager.powell-365.com/api/",findOwnProperty=function(properties,object){return Array.isArray(properties)?properties.filter(property=>object.hasOwnProperty(property)):properties},tryParseResource=function(item,localizedParam){try{var resources={};return JSON.parse(item[localizedParam]).forEach(resource=>resources[resource.LCID]=resource),resources}catch(exception){return{0:{Code:null,LCID:0,Value:item[localizedParam]}}}},localizableItemSetBody=function(localization,originalLocalizableItem,languages,itemType){var bodyForCreate={},generateBody=(itemType,localization,languages,originalLocalizableItem)=>{var createParams=itemType.createParams,localizedParam=itemType.localizedParam,originalItem=originalLocalizableItem.itemFromManager,originalItemParent=originalLocalizableItem.parentItem;return createParams.reduce((body,param)=>{if(localization&&param===localizedParam||itemType.additionalLocalizedParams&&itemType.additionalLocalizedParams.find(additionalParam=>additionalParam.param===param)&&localization[param])body[param]=JSON.stringify(localization[param].map(localizedValue=>{var language=_.find(languages,language=>language.Lcid.toString()===localizedValue.LCID);return localizedValue.Code=language.Code,null!==language.Code?localizedValue.Label=language.Title:localizedValue.LCID=0,localizedValue}));else if(param.indexOf("=")>-1){var expression=param.match(/([^=]+)=(.+)/);if(originalItem.hasOwnProperty(expression[1])){var expressionToEval=expression[2].replace(/\$ITEM_FROM_MANAGER/gi,"originalItem").replace(/\$PARENT_ITEM_FROM_MANAGER/gi,"originalItemParent");try{body[expression[1]]=eval(expressionToEval)}catch(ex){body[expression[1]]=null}}}else originalItem.hasOwnProperty(param)&&(body[param]=originalItem[param]);return body},{})};switch(itemType){case ITEM_TYPES.NAVIGATION:bodyForCreate=runThroughTree(originalLocalizableItem.itemFromManager,["Nodes","ChildrenNodes"],item=>generateBody(itemType,localization.Nodes[item.Id],languages,{itemFromManager:item}),!1);break;case ITEM_TYPES.WIDGET:case ITEM_TYPES.WIDGET_IN_PAGE_TEMPLATE:bodyForCreate=generateBody(itemType,localization,languages,originalLocalizableItem),originalLocalizableItem.itemFromManager.Config&&localization.Config&&(bodyForCreate.Config=JSON.stringify(_.merge(JSON.parse(originalLocalizableItem.itemFromManager.Config),localization.Config)));break;default:bodyForCreate=generateBody(itemType,localization,languages,originalLocalizableItem)}return bodyForCreate},manageAdditionalParams=function(itemType,currentItem,items,childrenProperties){itemType.additionalLocalizedParams&&itemType.additionalLocalizedParams.forEach((additionalLocalizedParam,index)=>{if(currentItem[additionalLocalizedParam.param]){var currentItemProperty=_.cloneDeep(currentItem);currentItemProperty._Parent=currentItem,currentItemProperty._IsProperty=!0,index!==itemType.additionalLocalizedParams.length-1||currentItem[findOwnProperty(childrenProperties,currentItem)]&&0!==currentItem[findOwnProperty(childrenProperties,currentItem)].length||(currentItemProperty._LastChild=!0),currentItemProperty._Property=additionalLocalizedParam.param,currentItemProperty._PropertyRenderPrefix=additionalLocalizedParam.prefix,currentItemProperty[itemType.localizedParam]=currentItem[additionalLocalizedParam.param],items.push(currentItemProperty)}})},flattenWidgetConfig=function(widget){var flattenProperties=[],config=JSON.parse(widget.Config),localizedParams=WIDGET_TYPES[widget.Widget.Name].localizedParams;return localizedParams.forEach(localizedParam=>{var includeIfPreficate=localizedParam.includeIf.replace(/\{\{([^}]+)\}\}/i,(toReplace,key)=>'_.get(config, "'+key+'")');if(!includeIfPreficate||(includeIfPreficate=eval(includeIfPreficate),includeIfPreficate)){var pushFlattenProperty=(config,param,widget,localizedParam)=>{var resourcesForParam,optionalParamTitle;if(param.indexOf("|")?(params=param.split("|"),resourcesForParam=params.reduce((value,currentKey)=>value||_.get(config,currentKey),"")):resourcesForParam=_.get(config,param),!resourcesForParam)return!1;"object"==typeof resourcesForParam&&(resourcesForParam=JSON.stringify(resourcesForParam));try{optionalParamTitle=JSON.parse(resourcesForParam).find(resource=>"0"===resource.LCID||0===resource.LCID).Value}catch(ex){optionalParamTitle=resourcesForParam}var propertyAsObject={Id:widget.Id,PageId:widget.PageId,WidgetName:widget.Widget.Name,SiteTemplateName:widget.SiteTemplateName,PageName:widget.PageName,_Property:localizedParam.title.replace("$param",optionalParamTitle),Title:resourcesForParam,LocalizedTitle:widget.LocalizedTitle.toUpperCase()};flattenProperties.push(propertyAsObject)};if(localizedParam.iterate){var flattenIterableParam=(object,key)=>{var paramPaths=key.match(/\.?([^[]+(?:\[\])?)(.+|$)/i);if((key=paramPaths[1]).indexOf("[]")<0)return pushFlattenProperty(object,key,widget,localizedParam),!0;key=key.slice(0,-2);var keyTail=paramPaths[2],toIterate;_.get(object,key,[]).forEach(iterable=>{flattenIterableParam(iterable,keyTail)})};flattenIterableParam(config,localizedParam.param)}else pushFlattenProperty(config,localizedParam.param,widget,localizedParam)}}),flattenProperties},runThroughTree=function(item,childrenProperties,itemCallback,includeRoot,rootItem){var passParentItemToCallback=item!==(rootItem=rootItem||item)||includeRoot;if(includeRoot&&item===rootItem){var rootCallbackResult=itemCallback(item,!0,null,item);rootCallbackResult&&(item=rootCallbackResult)}var childrenArray=item[findOwnProperty(childrenProperties,item)];return childrenArray&&childrenArray.forEach((childItem,index,children)=>{var isLastChild=!1;index===children.length-1&&(isLastChild=!0);var callbackResult=itemCallback(childItem,isLastChild,passParentItemToCallback?item:null,rootItem);callbackResult&&(children[index]=childItem=callbackResult),runThroughTree(childItem,childrenProperties,itemCallback,includeRoot,rootItem)}),item},flattenTree=function(rootItem,childrenProperties,itemCallback,includeRoot,itemType){var flattenItems=[],rootItemClone=_.cloneDeep(rootItem);return runThroughTree(rootItemClone,childrenProperties,(currentItem,isLastChild,parentItem,rootItem)=>{isLastChild&&(currentItem._LastChild=!0),parentItem&&(currentItem._Parent=parentItem),itemCallback(currentItem,parentItem,rootItem),flattenItems.push(currentItem)},includeRoot),flattenItems},renderAsTree=function(currentItem,itemResources,propertyToRender){var treeIntersection=currentItem._LastChild?"└":"|",buildTreeIndent=(item,indentString)=>{indentString=indentString||"";var parent=item._Parent;return parent?(indentString=(parent._LastChild?"    ":"|   ")+indentString,buildTreeIndent(parent,indentString)):indentString};_.set(itemResources,propertyToRender,buildTreeIndent(currentItem)+treeIntersection+(currentItem._IsProperty?"   "+currentItem._PropertyRenderPrefix:"─── ")+_.get(itemResources,propertyToRender))},buildRequireChain=function(itemType){var requireChain=[];switch(itemType){case ITEM_TYPES.CONTENT_TYPE:case ITEM_TYPES.FIELD:case ITEM_TYPES.LIST_TEMPLATE:case ITEM_TYPES.PAGE_TEMPLATE:case ITEM_TYPES.SITE_TEMPLATE:case ITEM_TYPES.PAGE:requireChain.push("Default (0)");break;case ITEM_TYPES.LIST:case ITEM_TYPES.WIDGET:case ITEM_TYPES.NAVIGATION:case ITEM_TYPES.SITE:}var internalBuildFunction=requires=>{var popableRequires=Array().concat(requires);0!==popableRequires.length&&(requireChain.unshift(popableRequires.pop()),ITEM_TYPES[requireChain[0]].require.length>0&&internalBuildFunction(ITEM_TYPES[requireChain[0]].require),internalBuildFunction(popableRequires))};return internalBuildFunction(itemType.require),requireChain},renderResource=function(resources,itemType){var sortCallback=()=>0,requireChain=buildRequireChain(itemType),resourceItems;return 1===requireChain.length?sortCallback=firstBy(requireChain[0]):requireChain.length>1&&(sortCallback=requireChain.reduce((sortChain,currentSort)=>"string"==typeof sortChain?firstBy(sortChain).thenBy(currentSort):sortChain.thenBy(currentSort))),itemType.consolidate(resources[itemType.name].items).sort(sortCallback).reduce((resourceItemsAndAdditionalParams,item)=>(resourceItemsAndAdditionalParams.push(item),manageAdditionalParams(itemType,item,resourceItemsAndAdditionalParams),resourceItemsAndAdditionalParams),[]).map(item=>{var itemResources=tryParseResource(item,itemType.localizedParam);itemType!==ITEM_TYPES.NAVIGATION&&itemType!==ITEM_TYPES.SITE||renderAsTree(item,itemResources,[0,"Value"]),Object.keys(itemResources).forEach(lcid=>{itemResources[lcid]=itemResources[lcid].Value}),itemResources[0]&&"string"==typeof itemResources[0]||(itemResources=[item.LocalizationTitle||item.LocalizationName].concat(itemResources));var itemResourcesAsFlatObject=itemType.initFlatObject(item);return resources.availableLanguages.forEach(language=>{itemResourcesAsFlatObject[language.Title+" ("+language.Lcid+")"]=itemResources[language.Lcid]}),itemResourcesAsFlatObject})},importResource=function(worksheet,resources,itemType){return new Promise(resolve=>{var itemsFromSheet;switch(itemType){case ITEM_TYPES.NAVIGATION:itemsFromSheet=Object.values(worksheet.reduce((navigations,navigationNode)=>((navigations[navigationNode.NAVIGATION_ID]=navigations[navigationNode.NAVIGATION_ID]||{Id:navigationNode.NAVIGATION_ID,Nodes:[]}).Nodes.push(navigationNode),navigations),{}));break;case ITEM_TYPES.WIDGET:case ITEM_TYPES.WIDGET_IN_PAGE_TEMPLATE:itemsFromSheet=Object.values(worksheet.reduce((widgets,widget)=>(widgets[widget.ID]=widgets[widget.ID]||widget,widgets[widget.ID].Config=widgets[widget.ID].Config||{},widget.WIDGET_PROPERTY!==itemType.localizedParam&&(widgets[widget.ID].Config[widget.WIDGET_PROPERTY]=widget),widgets),{}));break;default:itemsFromSheet=Object.values(worksheet.reduce((items,item)=>(items[item.ID]=items[item.ID]||item,itemType.additionalLocalizedParams&&itemType.additionalLocalizedParams.forEach(additionalLocalizedParam=>{item[ITEM_TYPES.toSheetName(itemType)+"_PROPERTY"]===additionalLocalizedParam.param&&(items[item.ID][item[ITEM_TYPES.toSheetName(itemType)+"_PROPERTY"]]=item)}),items),{}))}var resourceItems=new Models.ResourceItemsCollection(itemType,resources);itemsFromSheet.forEach((item,index)=>{resourceItems.itemsUpdated.push(new Promise(resourceUpdatedResolve=>{var itemFromSheet=itemType.fromSheetObject(item,resources.availableLanguages);resources.getCorrespondingManagerItem(itemType,itemFromSheet).then(result=>{try{var createItemBody;if(itemType.consolidateBeforeSave){createItemBody=Endpoints[itemType.name].set.body(itemFromSheet,result,resources.availableLanguages);var parentItem=result.parentItem,parentItemChildren=parentItem[itemType.consolidateBeforeSave.storeInto]||(parentItem[itemType.consolidateBeforeSave.storeInto]=[]),childItemIndex=_.findIndex(parentItemChildren,childItem=>childItem.Id===result.itemFromManager.Id);0===parentItemChildren.length||-1===childItemIndex?parentItemChildren.push(createItemBody):parentItemChildren[childItemIndex]=createItemBody,resourceUpdatedResolve(parentItem)}else itemType.skipCreateIfSelected&&itemType.skipCreateIfSelected.filter(skipCreateIfSelected=>resources.selectedResources[skipCreateIfSelected]!==undefined)?resourceUpdatedResolve({itemFromSheet:itemFromSheet,itemFromManager:result.itemFromManager}):Endpoints[itemType.name].set&&(createItemBody=Endpoints[itemType.name].set.body(itemFromSheet,result,resources.availableLanguages),apiService.post(Endpoints[itemType.name].set.url,createItemBody,()=>{resourceUpdatedResolve({itemFromSheet:itemFromSheet,itemFromManager:result.itemFromManager})}))}catch(ex){console.log(ex.message,ex.stack)}})}))}),Promise.all(resourceItems.itemsUpdated).then(updatedResources=>{var promiseForGet=resources.resourcesToWaitBeforeGet[itemType.name];if(promiseForGet&&promiseForGet.resolve(updatedResources),itemType.consolidateBeforeSave){var parentItemType=ITEM_TYPES[itemType.consolidateBeforeSave.parentItemType],parentItemsUpdated=[];Promise.all(Object.values(resources[parentItemType.name].sheetItemsLoaded)).then(items=>{items.forEach(item=>{parentItemsUpdated.push(new Promise(parentItemUpdatedResolve=>{var createItemBody;createItemBody=resources.selectedResources.find(selectedResource=>selectedResource===parentItemType)?Endpoints[parentItemType.name].set.body(item.itemFromSheet,item,resources.availableLanguages):Endpoints[parentItemType.name].set.body(null,item,resources.availableLanguages),apiService.post(Endpoints[parentItemType.name].set.url,createItemBody,()=>{parentItemUpdatedResolve()})}))}),Promise.all(parentItemsUpdated).then(resolve)})}else resolve()})})},Models={ResourceToWait:function(){var _this=this;_this.promise=new Promise(resolve=>{_this.resolve=resolve})},Resources:function(selectedResources,generateFileReadEndPromise){var _this=this,resourcesPromises=[];_this.resourcesToWaitBeforeGet={},_this.selectedResources=Array().concat(selectedResources),_this.addNewResource=(promise=>{resourcesPromises.push(promise)}),_this.allResourcesLoaded=(()=>new Promise(resolve=>{Promise.all(resourcesPromises).then(values=>{resolve(_this)})})),generateFileReadEndPromise&&(_this.fileReadEnd=new Promise(resolve=>{_this.fileReadEndResolve=resolve})),_this.availableLanguages=[],_this.languagesLoaded=new Promise(resolve=>{apiService.post(Endpoints.ResourceLanguages.get.url,null,response=>{var languages=response.data;languages.unshift({Code:null,Title:"Default",Lcid:0}),_this.availableLanguages=languages,resolve(languages)})}),_this.addNewResource(_this.languagesLoaded),_this.parseFromManager=(()=>{_this.selectedResources.forEach(itemType=>{var resourceItems;new Models.ResourceItemsCollection(itemType,_this).getAllItems()})}),_this.getCorrespondingManagerItem=((itemType,sheetItem)=>{var itemFromManager,itemFromManagerPromise;if(_this[itemType.name]&&_this[itemType.name].items&&(itemFromManager=_this[itemType.name].items.find(item=>itemType.comparator(item,sheetItem)))&&(itemFromManagerPromise=new Promise(resolve=>resolve({itemFromManager:itemFromManager}))),!itemFromManager){var resourcesToWait=[];itemType.waitBeforeGet&&(resourcesToWait=_.intersection(_this.selectedResources,itemType.waitBeforeGet.map(waitResource=>ITEM_TYPES[waitResource]))).forEach(resourceToWait=>{_this.resourcesToWaitBeforeGet[resourceToWait.name]=_this.resourcesToWaitBeforeGet[resourceToWait.name]||new Models.ResourceToWait}),itemFromManagerPromise=new Promise(resolve=>{Promise.all(resourcesToWait.map(resourceToWait=>_this.resourcesToWaitBeforeGet[resourceToWait.name].promise)).then(()=>{var resourceItems=new Models.ResourceItemsCollection(itemType,_this);switch(itemType){case ITEM_TYPES.NAVIGATION:resourceItems.getAllItems(),resourceItems.itemsLoaded.then(()=>{resolve(_this.getCorrespondingManagerItem(itemType,sheetItem))});break;case ITEM_TYPES.WIDGET:case ITEM_TYPES.WIDGET_IN_PAGE_TEMPLATE:var parentItemType=sheetItem.IsFromPageTemplate?ITEM_TYPES.PAGE_TEMPLATE:ITEM_TYPES.PAGE,parentResourceItems;(parentResourceItems=new Models.ResourceItemsCollection(parentItemType,_this)).addBySheetItem(sheetItem,"PageId").then(parentPage=>{resourceItems.addBySheetItem(sheetItem,"Id","PageId").then(widget=>{resolve({itemFromManager:widget.itemFromManager,parentItem:parentPage.itemFromManager})})});break;case ITEM_TYPES.SITE:var parentResourceItems;(parentResourceItems=new Models.ResourceItemsCollection(ITEM_TYPES.SITE_COLLECTION,_this)).addBySheetItem(sheetItem,"SiteCollectionId").then(parentSiteCollection=>{resourceItems.addBySheetItem(sheetItem,"Id","SiteCollectionId").then(site=>{resolve({itemFromManager:site.itemFromManager,parentItem:parentSiteCollection.itemFromManager})})});break;default:resourceItems.addBySheetItem(sheetItem).then(itemFromManager=>{resolve(itemFromManager)})}})})}return itemFromManagerPromise})},ResourceItemsCollection:function(itemType,resourcesObject){var _this=this,alreadyInitialized=!1,itemsLoadedResolve;if(_this.itemType=itemType,resourcesObject[_this.itemType.name]!==undefined)return resourcesObject[_this.itemType.name];_this.items=[],_this.sheetItemsLoaded={},_this.itemsUpdated=[],_this.itemsLoaded=new Promise(resolve=>{itemsLoadedResolve=resolve}),resourcesObject[_this.itemType.name]=_this,resourcesObject.addNewResource(_this.itemsLoaded),_this.addBySheetItem=((sheetItem,idPropertyOverride,parentIdProperty)=>(_this.sheetItemsLoaded[sheetItem[idPropertyOverride||"Id"]]=_this.sheetItemsLoaded[sheetItem[idPropertyOverride||"Id"]]||new Promise(resolve=>{var body=null;switch(_this.itemType){case ITEM_TYPES.WIDGET:var parentItemType=sheetItem.IsFromPageTemplate?ITEM_TYPES.PAGE_TEMPLATE:ITEM_TYPES.PAGE;return void resourcesObject[parentItemType.name].sheetItemsLoaded[sheetItem[parentIdProperty]].then(parentPage=>{var itemFromManager=parentPage.itemFromManager.WebParts.find(webPart=>webPart.Id===sheetItem.Id);_this.items.push(itemFromManager),resolve({itemFromSheet:sheetItem,itemFromManager:itemFromManager})});default:body=Endpoints[_this.itemType.name].getBySheetItem.body(sheetItem[idPropertyOverride||"Id"],sheetItem[parentIdProperty])}apiService.post(Endpoints[_this.itemType.name].getBySheetItem.url,body,response=>{var itemFromManager=response.data;_this.items.push(itemFromManager),resolve({itemFromSheet:sheetItem,itemFromManager:itemFromManager})})}),_this.sheetItemsLoaded[sheetItem[idPropertyOverride||"Id"]])),_this.getResourcesForItemType=(requiredParentItem=>new Promise(resolve=>{var body=null;switch(_this.itemType){case ITEM_TYPES.LIST_TEMPLATE:case ITEM_TYPES.CONTENT_TYPE:case ITEM_TYPES.NAVIGATION:case ITEM_TYPES.SITE_COLLECTION:body=Endpoints[_this.itemType.name].get.body(1e3);break;case ITEM_TYPES.PAGE:case ITEM_TYPES.LIST:case ITEM_TYPES.WIDGET:case ITEM_TYPES.WIDGET_IN_PAGE_TEMPLATE:case ITEM_TYPES.FIELD:case ITEM_TYPES.SITE:body=Endpoints[_this.itemType.name].get.body(requiredParentItem.Id)}apiService.post(Endpoints[_this.itemType.name].get.url,body,response=>{switch(_this.itemType){case ITEM_TYPES.LIST_TEMPLATE:case ITEM_TYPES.LAYOUTS:case ITEM_TYPES.SITE_COLLECTION:_this.items=_this.items.concat(response.data.Items);break;case ITEM_TYPES.CONTENT_TYPE:_this.items=_this.items.concat(response.data.filter(contentType=>contentType.CategoryName===$rootScope.Resources.dbRes("Title_ContentTypes_Section")));break;case ITEM_TYPES.FIELD:_this.items=_this.items.concat(response.data.Fields.filter(field=>(field.ContentTypeId=response.data.ContentTypeId,field.ContentTypeName=response.data.LocalizationName,!(field.IsInheritedFromClonedParent||field.IsStandard||field.IsInherited))));break;case ITEM_TYPES.SITE_TEMPLATE:_this.items=_this.items.concat(response.data.filter(siteTemplate=>siteTemplate.CategoryName===$rootScope.Resources.dbRes("Title_SiteTemplates_Custom_Section")));break;case ITEM_TYPES.LIST:_this.items=_this.items.concat(response.data.filter(list=>(list.SiteTemplateName=requiredParentItem.LocalizationTitle,list.IsEditable)));break;case ITEM_TYPES.PAGE:_this.items=_this.items.concat(response.data.map(page=>(page.SiteTemplateName=requiredParentItem.LocalizationTitle,page)));break;case ITEM_TYPES.WIDGET:case ITEM_TYPES.WIDGET_IN_PAGE_TEMPLATE:_this.items=_this.items.concat(response.data.WebParts.map(webPart=>(requiredParentItem.SiteTemplateName&&(webPart.SiteTemplateName=requiredParentItem.SiteTemplateName),webPart.PageName=requiredParentItem.LocalizationTitle,webPart)));break;case ITEM_TYPES.SITE:_this.items=_this.items.concat(response.data.map(site=>(site.SiteCollectionName=requiredParentItem.Title,site.SiteCollectionId=requiredParentItem.Id,site)));break;default:_this.items=_this.items.concat(response.data)}resolve(_this)})})),_this.getAllItems=(()=>{if(!alreadyInitialized){alreadyInitialized=!0;var requiredItemTypesPromises=[];_this.itemType.require.length>0&&_this.itemType.require.forEach(requiredItemType=>{var requiredItemTypePromise=new Promise(resolve=>{var requiredItems=new Models.ResourceItemsCollection(ITEM_TYPES[requiredItemType],resourcesObject);resourcesObject[ITEM_TYPES[requiredItemType].name].itemsLoaded.then(resourceItems=>{resolve(resourceItems)}),requiredItems.getAllItems()});requiredItemTypesPromises.push(requiredItemTypePromise)}),Promise.all(requiredItemTypesPromises).then(requiredItemTypes=>{var forEachablePromises=[];requiredItemTypes.length>0?requiredItemTypes.forEach(requiredItemType=>{requiredItemType.items.forEach(requiredItem=>{forEachablePromises.push(_this.getResourcesForItemType(requiredItem))})}):forEachablePromises.push(_this.getResourcesForItemType()),Promise.all(forEachablePromises).then(()=>{itemsLoadedResolve(_this)})})}})}};$scope.exportResources=function(){$rootScope.$broadcast("import-export-status-change",{loading:!0});var selectedResources=Object.values(ITEM_TYPES).filter(itemType=>itemType.hasOwnProperty("sheetName")),Resources=new Models.Resources(selectedResources);Resources.parseFromManager(),Resources.allResourcesLoaded().then(resources=>{var workbook=XLSX.utils.book_new();selectedResources.forEach(itemType=>{var worksheet=XLSX.utils.json_to_sheet(renderResource(resources,itemType));Object.keys(worksheet).length>1&&XLSX.utils.book_append_sheet(workbook,worksheet,itemType.sheetName)}),$rootScope.$broadcast("import-export-status-change",{loading:!1}),XLSX.writeFile(workbook,$rootScope.PartnerName+" - "+$rootScope.currentTenant.Text+".xlsx")})},$scope.getFile=function(file){$rootScope.$broadcast("import-export-status-change",{loading:!0});var reader=new FileReader;reader.addEventListener("load",()=>{var workbook=XLSX.read(reader.result,{type:"binary"}),resourceFileImportInput;if(workbook.Sheets&&workbook.SheetNames&&Array.isArray(workbook.SheetNames)){var selectedResources=workbook.SheetNames.map(sheetName=>ITEM_TYPES.fromSheetName(sheetName)).sort(firstBy("order")),Resources=new Models.Resources(selectedResources,!0);Resources.languagesLoaded.then(languages=>{var resourcesImported=[];selectedResources.forEach(itemType=>{itemType&&resourcesImported.push(importResource(XLSX.utils.sheet_to_json(workbook.Sheets[itemType.sheetName]),Resources,itemType))}),Resources.fileReadEndResolve(),Promise.all(resourcesImported).then(()=>{$rootScope.$broadcast("import-export-status-change",{loading:!1})})})}angular.element("#resourceFileImport").val("")}),reader.readAsBinaryString(file)},$scope.importResources=function(){var resourceFileImportInput;return angular.element("#resourceFileImport").click(),!0}},CONTROLLER_ID="resourcesManagerCtrl";angular.module("powellManager").controller(CONTROLLER_ID,resourcesManagerControllerModule),resourcesManagerControllerModule.$inject=["$rootScope","$scope","apiService"],angular.module("powellManager").config(["$routeProvider","$provide",function($routeProvider,$provide){$routeProvider.when("/resources",{templateUrl:"resourcesManager.html",controller:CONTROLLER_ID,params:{bc:"#/resources|Resources management"},regexp:/\/resources\/?/i}),$provide.decorator("sideBarDirective",["$delegate",function sideBarDecorator($delegate){var originalLinkFn=$delegate[0].link;return $delegate[0].compile=function(tElem,tAttr){var topnav=tElem.find(".main-menu .group-first-level:last-child .group-list-container");angular.element("head").append('<style>.sidebar .first-level.active .btn-resources {border-bottom-color: #5842a7;} .sidebar .btn-resources:before {content: "";background: #039be6;font-family: "icomoonManager";font-style: normal;font-variant: normal;font-weight: normal;text-transform: none;text-decoration: none;speak: none;-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;display: inline-block;vertical-align: top;width: 3.2rem;height: 3.2rem;line-height: 32px;color: #fff;border-radius: 50%;}</style>');var resourcesNode=angular.element('<li class="first-level"><a href="#/resources" data-ng-click="nodeNavActive($event, \'resources\')" class="btn-nav btn-resources" title="Resources"><span>Resources</span></a></li>');return topnav.append(resourcesNode),originalLinkFn},delete $delegate[0].link,$delegate}])}]),angular.bootstrap(document,["powellManager"])})}(window,window.angular,window.document);